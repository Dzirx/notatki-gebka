<!DOCTYPE html>
<html>
<head>
    <title>Klient - {{ klient.nazwapelna }}</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/styles.css') }}">
    <style>
        .klient-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #28a745;
        }
        
        .klient-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .klient-nazwa {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
            margin: 0;
        }
        
        .klient-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        
        .info-item {
            color: #6c757d;
        }
        
        .info-item strong {
            color: #495057;
        }
        
        .section-card {
            background: white;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            font-weight: bold;
            color: #495057;
        }
        
        .section-content {
            padding: 20px;
        }
        
        .samochod-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #007bff;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .samochod-item:hover {
            background: #e3f2fd;
        }
        
        .samochod-rejestracja {
            font-weight: bold;
            color: #007bff;
            font-size: 16px;
        }
        
        .samochod-details {
            color: #6c757d;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .notatka-item {
            background: #fff3cd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
        }
        
        .notatka-data {
            font-size: 12px;
            color: #856404;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .notatka-tresc {
            color: #495057;
        }
        
        .kosztorys-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #dc3545;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .kosztorys-info h5 {
            margin: 0 0 5px 0;
            color: #dc3545;
        }
        
        .kosztorys-opis {
            color: #6c757d;
            font-size: 14px;
        }
        
        .kosztorys-kwota {
            font-weight: bold;
            font-size: 18px;
            color: #dc3545;
        }
        
        .add-form {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 6px;
            margin-top: 15px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .form-row input {
            flex: 1;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-style: italic;
        }
        
        .btn-add {
            background: #17a2b8;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-add:hover {
            background: #138496;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Karta klienta -->
        <div class="klient-card">
            <div class="klient-header">
                <h1 class="klient-nazwa">üë§ {{ klient.nazwapelna }}</h1>
                <a href="/home" class="btn-secondary">‚Üê Powr√≥t</a>
            </div>
            
            <div class="klient-info">
                <div class="info-item">
                    <strong>Telefon:</strong> {{ klient.nr_telefonu or 'Brak' }}
                </div>
                <div class="info-item">
                    <strong>NIP:</strong> {{ klient.nip or 'Brak' }}
                </div>
                <div class="info-item">
                    <strong>Firma:</strong> {{ klient.nazwa_firmy or 'Osoba prywatna' }}
                </div>
                <div class="info-item">
                    <strong>Klient od:</strong> {{ klient.created_at.strftime('%d.%m.%Y') }}
                </div>
            </div>
        </div>

        <!-- Samochody -->
        <div class="section-card">
            <div class="section-header">
                üöó Samochody klienta
                <button class="btn-add" onclick="toggleAddSamochod()">+ Dodaj samoch√≥d</button>
            </div>
            <div class="section-content">
                {% if samochody %}
                    {% for samochod in samochody %}
                    <div class="samochod-item" onclick="window.location.href='/samochod/{{ samochod.nr_rejestracyjny }}'">
                        <div class="samochod-rejestracja">{{ samochod.nr_rejestracyjny }}</div>
                        <div class="samochod-details">
                            {{ samochod.marka }} {{ samochod.model }} 
                            {% if samochod.rok_produkcji %}({{ samochod.rok_produkcji }}){% endif %}
                        </div>
                    </div>
                    {% endfor %}
                    
                    <div id="addSamochodForm" class="add-form" style="display: none;">
                        <h5>Dodaj nowy samoch√≥d</h5>
                        <form action="/samochod/add/{{ klient.id }}" method="post">
                            <div class="form-row">
                                <input type="text" name="nr_rejestracyjny" placeholder="Nr rejestracyjny" required>
                                <input type="text" name="marka" placeholder="Marka" required>
                            </div>
                            <div class="form-row">
                                <input type="text" name="model" placeholder="Model" required>
                                <input type="number" name="rok_produkcji" placeholder="Rok produkcji">
                            </div>
                            <button type="submit" class="btn-primary">Dodaj samoch√≥d</button>
                            <button type="button" class="btn-secondary" onclick="toggleAddSamochod()">Anuluj</button>
                        </form>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p>Klient nie ma jeszcze ≈ºadnych samochod√≥w</p>
                        <button class="btn-primary" onclick="toggleAddSamochod()">Dodaj pierwszy samoch√≥d</button>
                    </div>
                    
                    <div id="addSamochodForm" class="add-form" style="display: none;">
                        <h5>Dodaj nowy samoch√≥d</h5>
                        <form action="/samochod/add/{{ klient.id }}" method="post">
                            <div class="form-row">
                                <input type="text" name="nr_rejestracyjny" placeholder="Nr rejestracyjny" required>
                                <input type="text" name="marka" placeholder="Marka" required>
                            </div>
                            <div class="form-row">
                                <input type="text" name="model" placeholder="Model" required>
                                <input type="number" name="rok_produkcji" placeholder="Rok produkcji">
                            </div>
                            <button type="submit" class="btn-primary">Dodaj samoch√≥d</button>
                            <button type="button" class="btn-secondary" onclick="toggleAddSamochod()">Anuluj</button>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Notatki -->
        {% if notatki %}
        <div class="section-card">
            <div class="section-header">üìù Notatki do pojazd√≥w klienta</div>
            <div class="section-content">
                {% for notatka in notatki %}
                <div class="notatka-item">
                    <div class="notatka-data">{{ notatka.created_at.strftime('%d.%m.%Y %H:%M') }}</div>
                    <div class="notatka-tresc">{{ notatka.tresc }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        function toggleAddSamochod() {
            const form = document.getElementById('addSamochodForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }
        
    </script>
</body>
</html>