<!DOCTYPE html>
<html>
<head>
    <title>Notatnik Warsztatowy</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/modules/notatnik/static/css/table.css">
    <link rel="stylesheet" href="/modules/notatnik/static/css/modal.css">
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üöó Notatnik Warsztatowy</h1>
            <div>
                <button class="btn-success" onclick="openModal()">+ Dodaj Notatkƒô</button>
                <a href="/" class="btn-secondary">‚Üê Dashboard</a>
            </div>
        </div>

        <!-- WYSZUKIWANIE -->
        <div class="search-rej">
            <input type="text" id="searchRejInput" placeholder="Wyszukaj po numerze rejestracyjnym lub tre≈õci notatki..." oninput="filterNotatkiByRej()">
            <button class="btn-secondary" onclick="clearRejSearch()">Wyczy≈õƒá</button>
        </div>

        <!-- AKCJE GRUPOWE -->
        <div class="actions-bar">
            <button class="btn-warning" onclick="editSelected()">‚úèÔ∏è Edytuj zaznaczone</button>
            <button class="btn-danger" onclick="deleteSelected()">üóëÔ∏è Usu≈Ñ zaznaczone</button>
            
            <!-- PRZYCISK FILTRA -->
            <button class="btn-info" id="toggleCompletedBtn" onclick="toggleCompletedNotes()">
                ‚úÖ Tylko zako≈Ñczone
            </button>
        </div>

        <!-- TABELA NOTATEK -->
        <h3>üìù Wszystkie notatki</h3>
        <table>
            <thead>
                <tr>
                    <th width="40">
                        <input type="checkbox" id="selectAll" onchange="toggleAllCheckboxes()">
                    </th>
                    <th>Status</th>
                    <th>Data</th>
                    <th>W≈Ça≈õciciel</th>
                    <th>Pojazd</th>
                    <th>Tre≈õƒá</th>
                    <th>Kosztorys</th>
                </tr>
            </thead>
            <tbody>
                {% for notatka in notatki %}
                <tr class="notatka-{{ notatka.typ_notatki }}" data-note-id="{{ notatka.id }}" data-nr-rej="{% if notatka.samochod %}{{ notatka.samochod.nr_rejestracyjny }}{% endif %}" data-status="{{ notatka.status|default('nowa') }}">
                <td>
                        <input type="checkbox" class="note-checkbox" value="{{ notatka.id }}">
                    </td>
                    <td>
                        <div class="status-container">
                            <span class="status-badge status-{{ notatka.status|default('nowa') }}" 
                                  onclick="showStatusMenu({{ notatka.id }}, this)"
                                  title="Kliknij aby zmieniƒá status">
                {% if notatka.status == 'w_trakcie' %}üü° W trakcie
                                {% elif notatka.status == 'zakonczona' %}üü¢ Zako≈Ñczona
                                {% elif notatka.status == 'anulowana' %}üî¥ Anulowana
                                {% elif notatka.status == 'oczekuje' %}üü† Oczekuje
                                {% else %}üîµ Nowa{% endif %}
                            </span>
                            <div class="status-menu" id="statusMenu{{ notatka.id }}" style="display: none;">
                                <div class="status-option {% if (notatka.status or 'nowa') == 'nowa' %}current{% endif %}" 
                                     data-status="nowa" data-text="Nowa" onclick="selectStatusFromMenu({{ notatka.id }}, this)">
                                    üîµ Nowa
                                </div>
                                <div class="status-option {% if notatka.status == 'w_trakcie' %}current{% endif %}" 
                                     data-status="w_trakcie" data-text="W trakcie" onclick="selectStatusFromMenu({{ notatka.id }}, this)">
                                    üü° W trakcie
                                </div>
                                <div class="status-option {% if notatka.status == 'zakonczona' %}current{% endif %}" 
                                     data-status="zakonczona" data-text="Zakonczona" onclick="selectStatusFromMenu({{ notatka.id }}, this)">
                                    üü¢ Zako≈Ñczona
                                </div>
                                <div class="status-option {% if notatka.status == 'anulowana' %}current{% endif %}" 
                                     data-status="anulowana" data-text="Anulowana" onclick="selectStatusFromMenu({{ notatka.id }}, this)">
                                    üî¥ Anulowana
                                </div>
                                <div class="status-option {% if notatka.status == 'oczekuje' %}current{% endif %}" 
                                     data-status="oczekuje" data-text="Oczekuje" onclick="selectStatusFromMenu({{ notatka.id }}, this)">
                                    üü† Oczekuje
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>{{ notatka.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    <td>
                        {% if notatka.samochod and notatka.samochod.klient %}
                            {{ notatka.samochod.klient.nazwapelna }}
                        {% else %}
                            Szybka notatka
                        {% endif %}
                    </td>
                    <td>
                        {% if notatka.samochod %}
                            {{ notatka.samochod.nr_rejestracyjny }}
                            <br><small>{{ notatka.samochod.marka }} {{ notatka.samochod.model }}</small>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="note-content">{{ notatka.tresc }}</td>
                    <td>
                        {% if notatka.kosztorysy %}
                            {% for kosztorys in notatka.kosztorysy %}
                                <a href="/notatnik/kosztorys-detail/{{ kosztorys.id }}" class="btn-small" style="display: block; margin-bottom: 5px;">
                                    üí∞ {{ kosztorys.numer_kosztorysu or 'KOS' }} - {{ "%.2f"|format(kosztorys.kwota_calkowita) }} z≈Ç
                                </a>
                            {% endfor %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- MODALE -->
        {% include 'modals/add_note_modal.html' %}
        {% include 'modals/edit_note_modal.html' %}
    </div>

    <script src="/modules/notatnik/static/js/note-core.js"></script>
    <script src="/modules/notatnik/static/js/note-add.js"></script>  
    <script src="/modules/notatnik/static/js/note-edit.js"></script>
    <script src="/modules/notatnik/static/js/note.js"></script>
</body>
</html>