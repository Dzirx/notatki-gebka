<!DOCTYPE html>
<html>
<head>
    <title>Kosztorysy - Notatka #{{ notatka.id }}</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/modules/notatnik/static/css/table.css">
    <link rel="stylesheet" href="/modules/notatnik/static/css/print.css" media="print">
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üí∞ Kosztorysy dla Notatki #{{ notatka.id }}</h1>
            <div class="no-print">
                <button onclick="printPage()" class="btn-primary" style="margin-right: 10px;">
                    üñ®Ô∏è Drukuj
                </button>
                <a href="/notatnik" class="btn-secondary">‚Üê Powr√≥t do notatek</a>
            </div>
        </div>

        <!-- INFORMACJE O NOTATCE -->
        <div class="card mb-4">
            <h3>üìù Informacje o notatce</h3>
            <p><strong>Data utworzenia:</strong> {{ notatka.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
            <p><strong>Typ:</strong> {{ notatka.typ_notatki }}</p>
            <p><strong>Tre≈õƒá:</strong> {{ notatka.tresc }}</p>
            {% if notatka.samochod %}
                <p><strong>Pojazd:</strong> {{ notatka.samochod.nr_rejestracyjny }} - {{ notatka.samochod.marka }} {{ notatka.samochod.model }}</p>
                {% if notatka.samochod.klient %}
                    <p><strong>W≈Ça≈õciciel:</strong> {{ notatka.samochod.klient.nazwapelna }}</p>
                {% endif %}
            {% endif %}
            
            <!-- DODATKOWE INFORMACJE DOSTAWA -->
            {% if notatka.data_dostawy or notatka.dostawca or notatka.nr_vat_dot or notatka.miejsce_prod %}
                <hr style="margin: 15px 0; border: 1px solid #ddd;">
                <h4>üì¶ Informacje o dostawie</h4>
                {% if notatka.data_dostawy %}
                    <p><strong>Data dostawy:</strong> {{ notatka.data_dostawy.strftime('%d.%m.%Y %H:%M') }}</p>
                {% endif %}
                {% if notatka.dostawca %}
                    <p><strong>Dostawca:</strong> {{ notatka.dostawca }}</p>
                {% endif %}
                {% if notatka.nr_vat_dot %}
                    <p><strong>Nr VAT DOT:</strong> {{ notatka.nr_vat_dot }}</p>
                {% endif %}
                {% if notatka.miejsce_prod %}
                    <p><strong>Miejsce produkcji:</strong> {{ notatka.miejsce_prod }}</p>
                {% endif %}
            {% endif %}
        </div>

        <!-- KOSZTORYSY -->
        {% if kosztorysy %}
            {% for kosztorys in kosztorysy %}
            <div class="card mb-4">
                <h3>üí∞ Kosztorys: {{ kosztorys.numer or 'Brak numeru' }}</h3>
                
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <strong>Kwota ca≈Çkowita:</strong> 
                        <span style="font-size: 1.2em; color: #28a745;">{{ "%.2f"|format(kosztorys.kwota_calkowita) }} z≈Ç</span>
                    </div>
                    <div>
                        <strong>Status:</strong> {{ kosztorys.status }}
                    </div>
                    <div>
                        <strong>Data:</strong> {{ kosztorys.created_at.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                </div>

                {% if kosztorys.opis %}
                    <p><strong>Opis:</strong> {{ kosztorys.opis }}</p>
                {% endif %}

                <!-- TOWARY -->
                {% if kosztorys.towary %}
                <h4>üì¶ Towary</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Nazwa towaru</th>
                            <th>Ilo≈õƒá</th>
                            <th>Cena jednostkowa</th>
                            <th>Warto≈õƒá</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for towar in kosztorys.towary %}
                        <tr>
                            <td>{{ towar.nazwa }}</td>
                            <td>{{ towar.ilosc }}</td>
                            <td>{{ "%.2f"|format(towar.cena) }} z≈Ç</td>
                            <td><strong>{{ "%.2f"|format(towar.ilosc * towar.cena) }} z≈Ç</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}

                <!-- US≈ÅUGI -->
                {% if kosztorys.uslugi %}
                <h4>üîß Us≈Çugi</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Nazwa us≈Çugi</th>
                            <th>Ilo≈õƒá</th>
                            <th>Cena jednostkowa</th>
                            <th>Warto≈õƒá</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for usluga in kosztorys.uslugi %}
                        <tr>
                            <td>{{ usluga.nazwa }}</td>
                            <td>{{ usluga.ilosc }}</td>
                            <td>{{ "%.2f"|format(usluga.cena) }} z≈Ç</td>
                            <td><strong>{{ "%.2f"|format(usluga.ilosc * usluga.cena) }} z≈Ç</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="card text-center">
                <h3>‚ùå Brak kosztorys√≥w</h3>
                <p>Ta notatka nie ma jeszcze ≈ºadnych kosztorys√≥w.</p>
                <a href="/notatnik" class="btn-primary">‚Üê Powr√≥t do notatek</a>
            </div>
        {% endif %}
    </div>

    <script src="/modules/notatnik/static/js/print-utils.js"></script>
</body>
</html>