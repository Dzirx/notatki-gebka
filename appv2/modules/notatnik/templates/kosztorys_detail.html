<!DOCTYPE html>
<html>
<head>
    <title>Kosztorysy - Notatka #{{ notatka.id }}</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/modules/notatnik/static/css/table.css">
    <link rel="stylesheet" href="/modules/notatnik/static/css/print.css" media="print">
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üí∞ Kosztorysy dla Notatki #{{ notatka.id }}</h1>
            <div class="no-print">
                <button onclick="printPage()" class="btn-primary" style="margin-right: 10px;">
                    üñ®Ô∏è Drukuj
                </button>
                <a href="/notatnik" class="btn-secondary">‚Üê Powr√≥t do notatek</a>
            </div>
        </div>

        <!-- INFORMACJE O NOTATCE I KLIENCIE -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;" class="info-grid">
            <!-- INFORMACJE O NOTATCE -->
            <div class="card">
                <h3>üìù Informacje o notatce</h3>
                <p><strong>Data utworzenia:</strong> {{ notatka.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                <p><strong>Typ:</strong> {{ notatka.typ_notatki }}</p>
                <p><strong>Tre≈õƒá:</strong> {{ notatka.tresc }}</p>
                {% if notatka.samochod %}
                    <p><strong>Pojazd:</strong> {{ notatka.samochod.nr_rejestracyjny }} - {{ notatka.samochod.marka }} {{ notatka.samochod.model }} ({{ notatka.samochod.rok_produkcji or 'brak roku' }})</p>
                {% endif %}
                
                <!-- DODATKOWE INFORMACJE DOSTAWA -->
                {% if notatka.data_dostawy or notatka.dostawca or notatka.nr_vat_dot or notatka.miejsce_prod %}
                    <hr style="margin: 15px 0; border: 1px solid #ddd;">
                    <h4>üì¶ Informacje o dostawie</h4>
                    {% if notatka.data_dostawy %}
                        <p><strong>Data dostawy:</strong> {{ notatka.data_dostawy.strftime('%d.%m.%Y %H:%M') }}</p>
                    {% endif %}
                    {% if notatka.dostawca %}
                        <p><strong>Dostawca:</strong> {{ notatka.dostawca }}</p>
                    {% endif %}
                    {% if notatka.nr_vat_dot %}
                        <p><strong>Nr VAT DOT:</strong> {{ notatka.nr_vat_dot }}</p>
                    {% endif %}
                    {% if notatka.miejsce_prod %}
                        <p><strong>Miejsce produkcji:</strong> {{ notatka.miejsce_prod }}</p>
                    {% endif %}
                {% endif %}
            </div>

            <!-- INFORMACJE O KLIENCIE -->
            <div class="card">
                {% if notatka.samochod and notatka.samochod.klient %}
                    <h3>üë§ Informacje o kliencie</h3>
                    <p><strong>Nazwa/Imiƒô:</strong> {{ notatka.samochod.klient.nazwapelna }}</p>
                    {% if notatka.samochod.klient.nr_telefonu %}
                        <p><strong>Telefon:</strong> 
                            <a href="tel:{{ notatka.samochod.klient.nr_telefonu }}" style="color: #007bff; text-decoration: none;">
                                üìû {{ notatka.samochod.klient.nr_telefonu }}
                            </a>
                        </p>
                    {% endif %}
                    {% if notatka.samochod.klient.email %}
                        <p><strong>Email:</strong> 
                            <a href="mailto:{{ notatka.samochod.klient.email }}" style="color: #007bff; text-decoration: none;">
                                ‚úâÔ∏è {{ notatka.samochod.klient.email }}
                            </a>
                        </p>
                    {% endif %}
                    {% if notatka.samochod.klient.nazwa_firmy %}
                        <p><strong>Firma:</strong> {{ notatka.samochod.klient.nazwa_firmy }}</p>
                    {% endif %}
                    {% if notatka.samochod.klient.nip %}
                        <p><strong>NIP:</strong> {{ notatka.samochod.klient.nip }}</p>
                    {% endif %}
                    <p><strong>Klient od:</strong> {{ notatka.samochod.klient.created_at.strftime('%d.%m.%Y') }}</p>
                {% else %}
                    <h3>üë§ Informacje o kliencie</h3>
                    <div style="text-align: center; color: #6c757d; padding: 20px;">
                        <p>üìù Notatka typu "{{ notatka.typ_notatki }}"</p>
                        <p>Brak przypisanego klienta</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- RESPONSYWNO≈öƒÜ - na telefonach jeden pod drugim -->
        <style>
            @media (max-width: 768px) {
                .info-grid {
                    grid-template-columns: 1fr !important;
                    gap: 15px;
                }
            }
        </style>

        <!-- ZA≈ÅƒÑCZNIKI -->
        {% if zalaczniki %}
        <div class="card mb-4 no-print">
            <h3>üìé Za≈ÇƒÖczniki</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                {% for zalacznik in zalaczniki %}
                <div class="attachment-item" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 15px; display: flex; align-items: center; gap: 10px;">
                    <div class="attachment-icon" style="font-size: 24px;">
                        {% if zalacznik.typ_mime.startswith('image/') %}
                            üñºÔ∏è
                        {% elif zalacznik.typ_mime == 'application/pdf' %}
                            üìÑ
                        {% elif 'word' in zalacznik.typ_mime %}
                            üìù
                        {% elif 'excel' in zalacznik.typ_mime or 'spreadsheet' in zalacznik.typ_mime %}
                            üìä
                        {% elif zalacznik.typ_mime.startswith('text/') %}
                            üìÉ
                        {% else %}
                            üìé
                        {% endif %}
                    </div>
                    <div class="attachment-info" style="flex: 1; min-width: 0;">
                        <div class="attachment-name" style="font-weight: 500; margin-bottom: 5px; word-break: break-word;">
                            {{ zalacznik.nazwa_pliku }}
                        </div>
                        <div class="attachment-size" style="font-size: 12px; color: #6c757d;">
                            {% set size_kb = (zalacznik.rozmiar / 1024)|round(1) %}
                            {% if size_kb < 1024 %}
                                {{ size_kb }} KB
                            {% else %}
                                {{ (size_kb / 1024)|round(1) }} MB
                            {% endif %}
                        </div>
                    </div>
                    <div class="attachment-actions">
                        <a href="/api/zalacznik/{{ zalacznik.id }}" 
                           class="btn-sm btn-primary" 
                           download="{{ zalacznik.nazwa_pliku }}"
                           style="text-decoration: none; background: #007bff; color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                            üì• Pobierz
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- KOSZTORYSY -->
        {% if kosztorysy %}
            {% for kosztorys in kosztorysy %}
            <div class="card mb-4">
                <h3>üí∞ Kosztorys: {{ kosztorys.numer or 'Brak numeru' }}</h3>
                
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <strong>Kwota ca≈Çkowita:</strong> 
                        <span style="font-size: 1.2em; color: #28a745;">{{ "%.2f"|format(kosztorys.kwota_calkowita) }} z≈Ç</span>
                    </div>
                    <div>
                        <strong>Status:</strong> {{ kosztorys.status }}
                    </div>
                    <div>
                        <strong>Data:</strong> {{ kosztorys.created_at.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                </div>

                {% if kosztorys.opis %}
                    <p><strong>Opis:</strong> {{ kosztorys.opis }}</p>
                {% endif %}

                <!-- TOWARY -->
                {% if kosztorys.towary %}
                <h4>üì¶ Towary</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Nazwa towaru</th>
                            <th>Ilo≈õƒá</th>
                            <th>Cena jednostkowa</th>
                            <th>Warto≈õƒá</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for towar in kosztorys.towary %}
                        <tr>
                            <td>{{ towar.nazwa }}</td>
                            <td>{{ towar.ilosc }}</td>
                            <td>{{ "%.2f"|format(towar.cena) }} z≈Ç</td>
                            <td><strong>{{ "%.2f"|format(towar.ilosc * towar.cena) }} z≈Ç</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}

                <!-- US≈ÅUGI -->
                {% if kosztorys.uslugi %}
                <h4>üîß Us≈Çugi</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Nazwa us≈Çugi</th>
                            <th>Ilo≈õƒá</th>
                            <th>Cena jednostkowa</th>
                            <th>Warto≈õƒá</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for usluga in kosztorys.uslugi %}
                        <tr>
                            <td>{{ usluga.nazwa }}</td>
                            <td>{{ usluga.ilosc }}</td>
                            <td>{{ "%.2f"|format(usluga.cena) }} z≈Ç</td>
                            <td><strong>{{ "%.2f"|format(usluga.ilosc * usluga.cena) }} z≈Ç</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="card text-center">
                <h3>‚ùå Brak kosztorys√≥w</h3>
                <p>Ta notatka nie ma jeszcze ≈ºadnych kosztorys√≥w.</p>
                <a href="/notatnik" class="btn-primary">‚Üê Powr√≥t do notatek</a>
            </div>
        {% endif %}
    </div>

    <script src="/modules/notatnik/static/js/print-utils.js"></script>
</body>
</html>